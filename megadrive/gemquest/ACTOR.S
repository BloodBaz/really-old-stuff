	.bss
	.globl	_actor_sprites
	.comm	_actor_sprites,1680
	.globl	_actor_map_x
	.comm	_actor_map_x,2
	.globl	_actor_map_y
	.comm	_actor_map_y,2
	.data
	.text
	.globl	_actor_move
_actor_move:
	link	a6,#-4
	movem.l	d3/d4/d5/d6/a3,-(sp)
	moveq.l	#42,d0
	mulu	8(a6),d0
	moveq.l	#0,d1
	move.w	d0,d1
	add.l	#_actor_sprites,d1
	move.l	d1,a3
	move.w	2(a3),d5
	move.w	4(a3),d6
	move.l	a3,-(sp)
	jsr	_sprite_move
	addq.w	#4,sp
	move.w	2(a3),d0
	add.w	_actor_map_x,d0
	and.w	_map_coord_x_mask,d0
	move.w	d0,d3
	move.w	4(a3),d0
	add.w	_actor_map_y,d0
	and.w	_map_coord_y_mask,d0
	move.w	d0,d4
	lsr.w	#4,d0
	and.w	_map_h_mask,d0
	move.w	d0,-(sp)
	move.w	d3,d0
	lsr.w	#4,d0
	and.w	_map_w_mask,d0
	move.w	d0,-(sp)
	jsr	_rpg_map_get_block
	addq.w	#4,sp
	cmp.b	#3,d0
	bhi	L4
	move.w	d4,d0
	lsr.w	#4,d0
	and.w	_map_h_mask,d0
	move.w	d0,-(sp)
	move.w	d3,d0
	add.w	#15,d0
	lsr.w	#4,d0
	and.w	_map_w_mask,d0
	move.w	d0,-(sp)
	jsr	_rpg_map_get_block
	addq.w	#4,sp
	cmp.b	#3,d0
	bhi	L4
	move.w	d4,d0
	add.w	#15,d0
	lsr.w	#4,d0
	and.w	_map_h_mask,d0
	move.w	d0,-(sp)
	move.w	d3,d0
	lsr.w	#4,d0
	and.w	_map_w_mask,d0
	move.w	d0,-(sp)
	jsr	_rpg_map_get_block
	addq.w	#4,sp
	cmp.b	#3,d0
	bhi	L4
	move.w	d4,d0
	add.w	#15,d0
	lsr.w	#4,d0
	and.w	_map_h_mask,d0
	move.w	d0,-(sp)
	move.w	d3,d0
	add.w	#15,d0
	lsr.w	#4,d0
	and.w	_map_w_mask,d0
	move.w	d0,-(sp)
	jsr	_rpg_map_get_block
	addq.w	#4,sp
	cmp.b	#3,d0
	bls	L3
L4:
	move.w	d5,2(a3)
	move.w	d6,4(a3)
L3:
	tst.w	8(a6)
	bne	L2
	move.w	2(a3),d0
	sub.w	#152,d0
	add.w	d0,_actor_map_x
	move.w	4(a3),d0
	sub.w	#104,d0
	add.w	d0,_actor_map_y
	move.w	_map_coord_x_mask,d0
	and.w	d0,_actor_map_x
	move.w	_map_coord_y_mask,d0
	and.w	d0,_actor_map_y
	move.w	#152,2(a3)
	move.w	#104,4(a3)
L2:
	movem.l	(sp)+,d3/d4/d5/d6/a3
	unlk	a6
	rts
