	.text
_swap:
	link	a6,#0
	movem.l	d3/d4/d5,-(sp)
	move.l	12(a6),d5
	move.l	8(a6),d4
	move.l	d4,a0
	move.w	(a0),d3
	move.l	d5,a0
	move.l	d4,a1
	move.w	(a0),(a1)
	move.l	d5,a0
	move.w	d3,(a0)
	movem.l	(sp)+,d3/d4/d5
	unlk	a6
	rts
	.text
_swapc:
	link	a6,#0
	movem.l	d3/d4/d5,-(sp)
	move.l	12(a6),d5
	move.l	8(a6),d4
	move.l	d4,a0
	move.b	(a0),d0
	ext.w	d0
	move.w	d0,d3
	move.l	d5,a0
	move.l	d4,a1
	move.b	(a0),(a1)
	move.l	d5,a0
	move.b	d3,(a0)
	movem.l	(sp)+,d3/d4/d5
	unlk	a6
	rts
	.text
	.globl	_quicksort
_quicksort:
	link	a6,#-8
	movem.l	d3/d4/d5/d6/d7,-(sp)
	move.w	12(a6),d5
	move.l	8(a6),d3
L9:
	cmp.w	#1,d5
	bls	L8
	move.w	d5,d0
	lsr.w	#1,d0
	lsl.w	#1,d0
	moveq.l	#0,d1
	move.w	d0,d1
	add.l	d3,d1
	move.l	d1,a0
	pea	(a0)
	move.l	d3,a0
	pea	(a0)
	jsr	_swap
	addq.w	#8,sp
	moveq.l	#0,d6
	move.w	d5,d4
L14:
	subq.w	#1,d4
	move.w	d4,d0
	lsl.w	#1,d0
	moveq.l	#0,d1
	move.w	d0,d1
	add.l	d3,d1
	move.l	d1,a0
	move.l	d3,a1
	move.w	(a0),d0
	cmp.w	(a1),d0
	bgt	L14
L17:
	addq.w	#1,d6
	move.w	d6,d0
	cmp.w	d4,d0
	bcc	L19
	move.w	d6,d0
	lsl.w	#1,d0
	moveq.l	#0,d1
	move.w	d0,d1
	add.l	d3,d1
	move.l	d1,a0
	move.l	d3,a1
	move.w	(a0),d0
	cmp.w	(a1),d0
	blt	L17
L19:
	move.w	d6,d0
	cmp.w	d4,d0
	bcs	L21
	move.l	d3,a0
	pea	(a0)
	move.w	d4,d0
	lsl.w	#1,d0
	moveq.l	#0,d1
	move.w	d0,d1
	add.l	d3,d1
	move.l	d1,a0
	pea	(a0)
	jsr	_swap
	addq.w	#8,sp
	move.w	d4,d7
	addq.w	#1,d4
	move.w	d5,d0
	sub.w	d4,d0
	move.w	d0,-8(a6)
	move.w	d7,d0
	cmp.w	-8(a6),d0
	bcc	L22
	move.w	d7,-(sp)
	move.l	d3,-(sp)
	jsr	_quicksort
	addq.w	#6,sp
	move.w	d4,d0
	lsl.w	#1,d0
	moveq.l	#0,d1
	move.w	d0,d1
	add.l	d1,d3
	move.w	-8(a6),d5
	bra	L9
L22:
	move.w	-8(a6),-(sp)
	move.w	d4,d0
	lsl.w	#1,d0
	moveq.l	#0,d1
	move.w	d0,d1
	add.l	d3,d1
	move.l	d1,-(sp)
	jsr	_quicksort
	addq.w	#6,sp
	move.w	d7,d5
	bra	L9
L21:
	move.w	d4,d0
	lsl.w	#1,d0
	moveq.l	#0,d1
	move.w	d0,d1
	add.l	d3,d1
	move.l	d1,a0
	pea	(a0)
	move.w	d6,d0
	lsl.w	#1,d0
	moveq.l	#0,d1
	move.w	d0,d1
	add.l	d3,d1
	move.l	d1,a0
	pea	(a0)
	jsr	_swap
	addq.w	#8,sp
	bra	L14
L8:
	movem.l	(sp)+,d3/d4/d5/d6/d7
	unlk	a6
	rts
	.data
	.text
	.globl	_quicksort_zorder
_quicksort_zorder:
	link	a6,#0
	movem.l	d3-d7/a3-a4,-(sp)
	move.l	8(a6),a3
	move.l	12(a6),a4
	move.w	16(a6),d3
L27:
	cmp.w	#1,d3
	bls	L26
	move.w	d3,d0
	lsr.w	#1,d0
	moveq.l	#0,d1
	move.w	d0,d1
	lea	0(a3,d1.l),a0
	pea	(a0)
	pea	(a3)
	jsr	_swapc
	addq.w	#8,sp
	move.w	d3,d0
	lsr.w	#1,d0
	lsl.w	#1,d0
	moveq.l	#0,d1
	move.w	d0,d1
	lea	0(a4,d1.l),a0
	pea	(a0)
	pea	(a4)
	jsr	_swap
	addq.w	#8,sp
	moveq.l	#0,d4
	move.w	d3,d5
L32:
	subq.w	#1,d5
	move.w	d5,d0
	lsl.w	#1,d0
	moveq.l	#0,d1
	move.w	d0,d1
	move.w	0(a4,d1.l),d0
	cmp.w	(a4),d0
	bgt	L32
L35:
	addq.w	#1,d4
	cmp.w	d5,d4
	bcc	L37
	move.w	d4,d0
	lsl.w	#1,d0
	moveq.l	#0,d1
	move.w	d0,d1
	move.w	0(a4,d1.l),d0
	cmp.w	(a4),d0
	blt	L35
L37:
	cmp.w	d5,d4
	bcs	L39
	pea	(a3)
	moveq.l	#0,d0
	move.w	d5,d0
	lea	0(a3,d0.l),a0
	pea	(a0)
	jsr	_swapc
	addq.w	#8,sp
	pea	(a4)
	move.w	d5,d0
	lsl.w	#1,d0
	moveq.l	#0,d1
	move.w	d0,d1
	lea	0(a4,d1.l),a0
	pea	(a0)
	jsr	_swap
	addq.w	#8,sp
	move.w	d5,d6
	addq.w	#1,d5
	move.w	d3,d0
	sub.w	d5,d0
	move.w	d0,d7
	cmp.w	d7,d6
	bcc	L40
	move.w	d6,-(sp)
	move.l	a4,-(sp)
	move.l	a3,-(sp)
	jsr	_quicksort_zorder
	lea	10(sp),sp
	moveq.l	#0,d0
	move.w	d5,d0
	add.l	d0,a3
	move.w	d5,d0
	lsl.w	#1,d0
	moveq.l	#0,d1
	move.w	d0,d1
	add.l	d1,a4
	move.w	d7,d3
	bra	L27
L40:
	move.w	d7,-(sp)
	move.w	d5,d0
	lsl.w	#1,d0
	moveq.l	#0,d1
	move.w	d0,d1
	add.l	a4,d1
	move.l	d1,-(sp)
	moveq.l	#0,d0
	move.w	d5,d0
	add.l	a3,d0
	move.l	d0,-(sp)
	jsr	_quicksort_zorder
	lea	10(sp),sp
	move.w	d6,d3
	bra	L27
L39:
	moveq.l	#0,d0
	move.w	d5,d0
	lea	0(a3,d0.l),a0
	pea	(a0)
	moveq.l	#0,d0
	move.w	d4,d0
	lea	0(a3,d0.l),a0
	pea	(a0)
	jsr	_swapc
	addq.w	#8,sp
	move.w	d5,d0
	lsl.w	#1,d0
	moveq.l	#0,d1
	move.w	d0,d1
	lea	0(a4,d1.l),a0
	pea	(a0)
	move.w	d4,d0
	lsl.w	#1,d0
	moveq.l	#0,d1
	move.w	d0,d1
	lea	0(a4,d1.l),a0
	pea	(a0)
	jsr	_swap
	addq.w	#8,sp
	bra	L32
L26:
	movem.l	(sp)+,d3-d7/a3-a4
	unlk	a6
	rts
